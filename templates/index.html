<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Dashboard Clients & Produits</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>ğŸ“¦ Dashboard Clients & Produits</h1>

    <h2>ğŸ’° CA par client (cliquez pour plus de dÃ©tails)</h2>
    {{ html_ca | safe }}
    <div id="details_ca" style="background-color: #f4f4f4; padding: 10px; margin-top: 10px;"></div>

    <h2>ğŸ“¦ FrÃ©quence des envois</h2>
    {{ html_freq | safe }}

    <h2>ğŸ“¦ Consommation de cartons</h2>
    {{ html_colis | safe }}

    <h2>ğŸ” Analyse marketing et logistique</h2>
    <ul>
        <li><b>Concentration du CA :</b> Peu de clients gÃ©nÃ¨rent la majoritÃ© du CA â†’ diversification utile.</li>
        <li><b>OpportunitÃ© de fidÃ©lisation :</b> Identifier les clients Ã  forte valeur mais faible frÃ©quence.</li>
        <li><b>Dominance colis :</b> Les grands cartons sont les plus frÃ©quents â†’ adapter le stock en consÃ©quence.</li>
    </ul>

    <script>
        const ca_plot = document.getElementById('ca_plot');
        ca_plot?.on('plotly_click', function(data){
            const client = data.points[0].x;
            fetch(`/details/${client}`)
                .then(res => res.json())
                .then(info => {
                    let html = `<h3>DÃ©tails pour <strong>${info.client}</strong></h3>
                        <p>ğŸ“¦ Nombre d'envois : ${info.total_envois}</p>
                        <p>ğŸ’° CA total : ${info.ca_total} â‚¬</p>
                        <p>ğŸ“… Dernier envoi : ${info.dernier_envoi}</p>
                        <p>ğŸ“¦ Types de colis :</p>
                        <ul>`;
                    for (let type in info.types_colis) {
                        html += `<li>${type} â†’ ${info.types_colis[type]}</li>`;
                    }
                    html += `</ul>`;
                    document.getElementById("details_ca").innerHTML = html;
                });
        });
    </script>
</body>
</html>
